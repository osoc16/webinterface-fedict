{% extends 'layout.twig' %}

{% set pageTitle = 'Fedict - Webinterface' %}

{% block pageContent %}
    <form action="index.php" method="post">
        <select name="searchOption">
            {% if searchOption == 'Catalog' %}
                <option value="Catalog" selected>Catalog</option>
            {% else %}
                <option value="Catalog">Catalog</option>
            {% endif %}
            {% if searchOption == 'Dataset' %}
                <option value="Dataset" selected>Dataset</option>
            {% else %}
                <option value="Dataset">Dataset</option>
            {% endif %}
            {% if searchOption == 'Distribution' %}
                <option value="Distribution" selected>Distribution</option>
            {% else %}
                <option value="Distribution">Distribution</option>
            {% endif %}
        </select>
        <input name="search" type="text" placeholder="Enter search term" value="{{ search }}"/>
        <input type="submit" value="Search">
    </form>


    <div class="tbl-header">
        <table cellpadding="0" cellspacing="0" border="0">
            <thead>
            <tr>
                <th>Subject</th>
                <th>Predicate</th>
                <th>Object</th>
            </tr>
            </thead>
        </table>
    </div>
    <div  class="tbl-content">
    <table cellpadding="0" cellspacing="0" border="0">
    <tbody>

    <script src='http://client.linkeddatafragments.org/scripts/ldf-client-jquery-packaged.js'></script>
    <script>
        var fragmentsClient = new ldf.FragmentsClient('http://185.14.185.158:5000/triplestore');
/* catalog and dataset search query */
        var query = 'SELECT * { ?s a <http://www.w3.org/ns/dcat#' + "{{ searchOption }}" + '> . ' +
                 '?s <http://purl.org/dc/terms/title> "' + "{{ search }}" + '"@en} LIMIT 10',
            results = new ldf.SparqlIterator(query, { fragmentsClient: fragmentsClient });


        /* dataset search query
         var query = 'SELECT * { ?s a <http://www.w3.org/ns/dcat#' + "{{ searchOption }}" + '> . ' +
         '?s <http://purl.org/dc/terms/title>"' + "{{ search }}" + '"@en} LIMIT 10',
         results = new ldf.SparqlIterator(query, { fragmentsClient: fragmentsClient });
         */





        //+        '?s <http://purl.org/dc/terms/title> <{{ search }}> ?o .
        //<{{ search }}>
        //var query = 'SELECT * {?s  ?p <http://www.w3.org/ns/dcat#' + "{{ searchOption }}" + '>. ?s ?p ?o } LIMIT 20',
    //  var query = 'SELECT * {<' + "{{ search }}" + '>  ?p <http://www.w3.org/ns/dcat#' + "{{ searchOption }}" + '>. ?s ?p ?o } LIMIT 20',
              //      results = new ldf.SparqlIterator(query, { fragmentsClient: fragmentsClient });
        if ("{{ search }}" == ""){
            var query = 'SELECT * {?s  ?p <http://www.w3.org/ns/dcat#' + "{{ searchOption }}" + '>. ?s ?p ?o } LIMIT 20',
            results = new ldf.SparqlIterator(query, { fragmentsClient: fragmentsClient });
        }
            results.on('data', function (data) {
                var subject = "";
                var predicate = "";
                var object = "";
                $.each(data, function(key, value) {
                    console.log("Key:" + key + " | value: " + value);
                    if (key == "?s") subject = value;
                    else if (key == "?p") predicate = value;
                    else if (key == "?o") {
                        object = value
                        var output =
                                '<tr>' +
                                '<td>'+ subject +'</td>' +
                                '<td>'+ predicate + '</td>' +
                                '<td>'+ object +'</td>' +
                                '</tr>';
                        console.log("Subject: " + subject + " - Predicate: " + predicate + " - Object: " + object);
                        $("tbody").append(output);
                        $('tr').click(function() {
                            document.location = 'webservice.php?subject=' + subject;
                        });
                    }
                });
        });
    </script>
    </tbody>
    </table>
    </div>

    <h2>URL Parameters</h2>
    <p>Search Option = {{ searchOption }}</p>
    <p>Search = {{ search }}</p>
{% endblock %}