{% extends 'layout.twig' %}

{% set pageTitle = 'Fedict - Detailpage' %}

{% block pageContent %}

    <a href="{{ subject }}" target="_blank">
        <h2>{{ subject|slice(0, 30) ~ '...' }}</h2>
    </a>

    <div class="description"></div>
    <h2>Services</h2>
    <div class="tbl-header">
        <table cellpadding="0" cellspacing="0" border="0">
            <thead>
            <tr>
                <th>Name</th>
            </tr>
            </thead>
        </table>
    </div>
    <div  class="tbl-content">
    <table cellpadding="0" cellspacing="0" border="0">
    <tbody>
    </tbody>
    </table>
    </div>
    <script src='http://client.linkeddatafragments.org/scripts/ldf-client-jquery-packaged.js'></script>
    <script>
        var fragmentsClient = new ldf.FragmentsClient('http://185.14.185.158:5000/triplestore');
        // var queryDescription = 'SELECT * {<'+ "{{ subject }}" + '>  <http://purl.org/dc/terms/description> ?o. ?s ?p ?o } LIMIT 5',
         var queryDescription = 'SELECT * {<'+ "{{ subject }}" + '>  ?p ?o} LIMIT 100',

        //var queryDescription = 'SELECT * {<'+ "{{ subject }}" + '>  <http://purl.org/dc/terms/description> ?o. ?s ?p ?o } LIMIT 5',
                results = new ldf.SparqlIterator(queryDescription, { fragmentsClient: fragmentsClient });
        results.on('data', function (data) {
            console.log(data);
            var predicate = "";
            $.each(data, function(key, value) {
                if (key == "?p") predicate = value;
                else if (key == "?o"){
                    if(value.indexOf("http") !=-1){
                        $(".description").append('<p>' + predicate.substr((predicate.lastIndexOf('/') + 1)) + ' - '
                                + '<b>'
                                + '<a target="_blank" href=' + value + '>' + value.substr((value.lastIndexOf('/') + 1)) + '</a>'
                                + '</b></p>');
                    } else{
                    $(".description").append('<p>' + predicate.substr((predicate.lastIndexOf('/') + 1)) + ' - '
                            + '<b>'
                            + value
                            + '</b></p>');
                    }
                }
            });
        });
        var queryMethods = 'SELECT * { ?s  <http://www.w3.org/ns/dcat#distribution> ?o. ?s ?p ?o  } LIMIT 100',
                results = new ldf.SparqlIterator(queryMethods, { fragmentsClient: fragmentsClient });
        results.on('data', function (data) {
            console.log(data);
            $.each(data, function(key, value) {
                if (key == "?o"){
                    var output =
                            '<tr>' +
                            '<td>'+ value +'</td>' +
                            '</tr>';
                    $("tbody").append(output);
                    $('tr').click(function() {
                        window.open(value, '_blank');
                    });
                }
            });
        });
    </script>
{% endblock %}