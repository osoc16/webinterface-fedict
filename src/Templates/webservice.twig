{% extends 'layout.twig' %}

{% set pageTitle = 'Fedict - Detailpage' %}

{% block pageContent %}

    <a href="{{ subject }}" target="_blank">
        <h2>{{ subject|slice(0, 30) ~ '...' }}</h2>
    </a>

    <div class="description"></div>
    <h2>Details</h2>
    <div class="tbl-header">
        <table cellpadding="0" cellspacing="0" border="0">
            <thead>
            <tr>
                <th>Key</th>
                <th>Value</th>
            </tr>
            </thead>
        </table>
    </div>
    <div  class="tbl-content">
    <table cellpadding="0" cellspacing="0" border="0">
    <tbody>
    </tbody>
    </table>
    </div>
    <script src='http://client.linkeddatafragments.org/scripts/ldf-client-jquery-packaged.js'></script>
    <script>
        var fragmentsClient = new ldf.FragmentsClient('http://185.14.185.158:5000/triplestore');
        var queryDescription = 'SELECT * {<'+ "{{ subject }}" + '>  ?p ?o} LIMIT 100',
                results = new ldf.SparqlIterator(queryDescription, { fragmentsClient: fragmentsClient });
        results.on('data', function (data) {
            //console.log(data);
            var predicate = "";
            var objData = "";
            var output = "";
            $.each(data, function(key, value) {
                if (key == "?p") predicate = value;
                else if (key == "?o") objData = value;

                if (predicate.length > 1 && objData.length > 1){
                    console.log("Predicate length: " + predicate.length + " Object length: " + objData.length);
                    console.log("Predicate: " + predicate + " Object: " + objData);

                    if(objData.indexOf('http') !=-1){
                        output =
                                '<tr>' +
                                '<td>' + predicate.substr((predicate.lastIndexOf('/') + 1)) + '</td>' +
                                '<td>' + objData.substr((objData.lastIndexOf('/') + 1)) + '</td>' +
                                '</tr>';
                        $("tbody").append(output);
                        console.log("Object VALUE: " + objData);
                        $('tr').click(function() {
                            window.open(objData, '_blank');
                        });
                    } else {
                        output =
                                '<tr>' +
                                '<td>' + predicate.substr((predicate.lastIndexOf('/') + 1)) + '</td>' +
                                '<td>' + objData + '</td>' +
                                '</tr>';
                        $("tbody").append(output);
                        $('tr').click(function() {
                            window.open("none", '_blank');
                        });
                    }
                    predicate = "";
                    object = "";
                }
            });
        });
        /*
        var queryMethods = 'SELECT * { ?s  <http://www.w3.org/ns/dcat#distribution> ?o. ?s ?p ?o  } LIMIT 100',
                results = new ldf.SparqlIterator(queryMethods, { fragmentsClient: fragmentsClient });
        results.on('data', function (data) {
            console.log(data);
            $.each(data, function(key, value) {
                if (key == "?o"){
                    var output =
                            '<tr>' +
                            '<td>'+ value +'</td>' +
                            '</tr>';
                    $("tbody").append(output);
                    $('tr').click(function() {
                        window.open(value, '_blank');
                    });
                }
            });
        });
         */
    </script>
{% endblock %}